generator client {
  provider        = "prisma-client-js"
  engineType      = "wasm"
}

datasource db {
  provider = "sqlite"
//  url      = "file:./dev.db"
}

model User {
  id                String      @id @default(cuid())
  email             String      @unique
  name              String?
  password          String
  inviteCode        InviteCode?
  isEmailVerified   Boolean     @default(false)
  verificationToken String?
  resetToken        String?
  resetTokenExpiresAt DateTime?
  role              String      @default("INDIVIDUAL") // INDIVIDUAL, SUPER_ADMIN, BUSINESS_ADMIN, BUSINESS_STAFF
  
  // NEW FIELDS
  profileId         String?     @unique
  isActivated       Boolean     @default(false)
  secretKey         String?
  status            String      @default("ACTIVE") // ACTIVE, INACTIVE, GRACE_PERIOD
  separatedAt       DateTime?   // Timestamp when staff was removed (start of 30-day grace)

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
  profile           Profile?
  organizationsAdmin Organization[]
}

model InviteCode {
  id        String   @id @default(cuid())
  code      String   @unique
  isUsed    Boolean  @default(false)
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?  @unique
  role      String   @default("INDIVIDUAL")
  email     String?
  
  // For Business Admin Invites
  organizationName String?
  organizationSlug String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tag {
  id        String   @id @default(cuid())
  name      String   @unique
  slug      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Profile {
  id              String        @id @default(cuid())
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId          String        @unique
  username        String        @unique // acts as slug/customSlug
  displayName     String?
  bio             String?
  avatarUrl       String?
  bannerUrl       String?
  position        String?
  department      String?
  companyName     String?
  companyId       String?
  isLockedByAdmin Boolean       @default(false)
  primaryColor    String?       @default("#0F172A")
  secondaryColor  String?       @default("#06B6D4")
  publicPhone     String?
  publicEmail     String?
  website         String?
  location        String?
  views           Int           @default(0)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  contacts        Contact[]
  documents       Document[]
  links           Link[]
  company         Organization? @relation(fields: [companyId], references: [id], onDelete: SetNull)
}

model Link {
  id        String   @id @default(cuid())
  profileId String
  title     String
  url       String
  icon      String?
  type      String   @default("SOCIAL") // SOCIAL, PHONE, EMAIL, WEBSITE, LOCATION
  category  String   @default("PERSONAL") // PERSONAL, OFFICE
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model Contact {
  id        String   @id @default(cuid())
  profileId String
  name      String
  email     String?
  phone     String?
  notes     String?
  source    String   @default("MANUAL")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model Document {
  id        String   @id @default(cuid())
  profileId String
  title     String
  url       String
  type      String   @default("PDF")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  profile   Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  @@index([profileId])
}

model Organization {
  id        String    @id @default(cuid())
  name      String
  slug      String    @unique
  logo      String?
  
  // NEW FIELDS
  maxSeats          Int       @default(5)
  
  adminId   String
  admin     User      @relation(fields: [adminId], references: [id], onDelete: Cascade)
  profiles  Profile[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model SystemSetting {
  key   String @id
  value String
}
